services:
  app:
    image: php:8.3-cli
    working_dir: /var/www/html
    entrypoint: []
    command:
      - bash
      - -c
      - |
        apt-get update && apt-get install -y \
          libsqlite3-dev \
          libzip-dev \
          unzip \
          git \
          && docker-php-ext-install pdo_sqlite zip \
          && curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \
          && composer install --no-interaction --prefer-dist \
          && tail -f /dev/null
    volumes:
      - .:/var/www/html
      - composer-cache:/tmp/cache
    networks:
      - ingest-demo
    environment:
      COMPOSER_CACHE_DIR: /tmp/cache
      DB_CONNECTION: sqlite
      DB_DATABASE: /var/www/html/database/database.sqlite
      QUEUE_CONNECTION: sync

volumes:
  composer-cache:

networks:
  ingest-demo:
    driver: bridge
